<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비디오 시청 중 댓글 읽기 지원 연구 – 테스트</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', '맑은 고딕', Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 26px;
            margin-bottom: 20px;
            color: #333;
        }

        h2 {
            font-size: 19px;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #333;
        }

        p, span {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
        }

        .video-container {
            text-align: left;
            margin-bottom: 30px;
        }

        .interface-media {
            width: 500px;
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: block;
        }

        .interface-media + .interface-media-caption {
            margin-top: 8px;
        }

        ol, ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        li {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }

        .form-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-size: 16px;
            margin-bottom: 8px;
            color: #333;
            font-weight: normal;
        }

        .form-group label .required {
            color: #e74c3c;
            margin-right: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }

        .form-group input.error {
            border-color: #e74c3c;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .btn-container {
            text-align: center;
            margin-top: 40px;
        }

        .btn-next {
            background-color: #3498db;
            color: white;
            padding: 12px 40px;
            font-size: 18px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-next:hover {
            background-color: #2980b9;
        }

        .btn-next:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        strong {
            font-weight: bold;
        }

        u {
            text-decoration: underline;
        }

        .highlight {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>비디오 시청 중 댓글 읽기 지원 연구 – 테스트 A</h1>
        
        <p><span style="font-size:16px;">안녕하세요, 연구에 참여해 주셔서 감사합니다.<br>
        본 연구는 <strong>비디오 시청 중 댓글 읽기 경험</strong>을 지원하는 인터페이스를 평가하기 위한 사용자 테스트입니다.</span></p>

        <h2><span style="font-size:19px;"><strong>진행 방법</strong></span></h2>
        <p><span style="font-size:16px;">다섯 가지 방식의 인터페이스에서 <strong><span style="color: red; font-weight: bold; text-decoration: underline;">영상을 시청하며 동시에 댓글을 읽어보시게 됩니다.</span></strong></span></p>

        <div id="interfaceList"></div>

        <p>각 인터페이스에서 영상 시청을 마친 뒤, 다음 네 가지 문항에 답해주세요.</p>

        <ol id="questionList"></ol>

        <h2>유의사항</h2>
        <ul>
            <li><u><strong>PC 환경</strong></u>에서 진행해 주세요.</li>
            <li>반드시 <b>소리를 켠 상태</b>에서 시청해 주세요.</li>
            <li><b>각 영상을 처음부터 끝까지, 스킵 없이 시청하시며 댓글을 읽어나가 주세요.</b></li>
            <li>문의사항은 010-3610-8659 (김민선) 으로 부탁드립니다 : )</li>
        </ul>

        <p>⏱ 예상 소요 시간은 약 10분 이내입니다.</p>

        <div class="form-section">
            <p style="font-size: 16px; margin-bottom: 20px;">아래 참가자 기본 정보 항목을 모두 작성해 주세요.</p>
            
            <form id="participantForm">
                <div class="form-group">
                    <label for="name">
                        <span class="required">*</span>성명
                    </label>
                    <input type="text" id="name" name="name" required>
                    <div class="error-message" id="nameError">성명을 입력해주세요.</div>
                </div>

                <div class="form-group">
                    <label for="age">
                        <span class="required">*</span>만 나이
                    </label>
                    <input type="number" id="age" name="age" min="1" max="150" required>
                    <div class="error-message" id="ageError">만 나이를 입력해주세요.</div>
                </div>

                <div class="form-group">
                    <label for="gender">
                        <span class="required">*</span>성별(남/여)
                    </label>
                    <input type="text" id="gender" name="gender" placeholder="남 또는 여" required>
                    <div class="error-message" id="genderError">성별을 입력해주세요. (남 또는 여)</div>
                </div>

                <div class="btn-container">
                    <button type="submit" class="btn-next" id="nextBtn">다음</button>
                </div>
            </form>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        const interfaceList = document.getElementById('interfaceList');
        function createInterfaceMediaElement(mediaPath) {
            if (!mediaPath) {
                return null;
            }

            const lower = mediaPath.toLowerCase();
            if (lower.endsWith('.mp4') || lower.endsWith('.webm')) {
                const video = document.createElement('video');
                video.className = 'interface-media';
                video.autoplay = true;
                video.loop = true;
                video.muted = true;
                video.playsInline = true;
                const source = document.createElement('source');
                source.src = mediaPath;
                source.type = lower.endsWith('.webm') ? 'video/webm' : 'video/mp4';
                video.appendChild(source);
                video.innerHTML += '브라우저가 비디오를 지원하지 않습니다.';
                return video;
            }

            const img = document.createElement('img');
            img.className = 'interface-media';
            img.src = mediaPath;
            img.alt = '인터페이스 미리보기';
            return img;
        }

        async function renderInterfaceList() {
            if (!interfaceList) {
                return;
            }

            try {
                const descriptions = await loadInterfaceDescriptions();
                interfaceList.innerHTML = '';
                descriptions.forEach(item => {
                    const block = document.createElement('div');
                    block.className = 'video-container';

                    const desc = document.createElement('p');
                    desc.innerHTML = `<strong>${item.title}:</strong> ${item.description}`;
                    block.appendChild(desc);

                    const mediaEl = createInterfaceMediaElement(item.media);
                    if (mediaEl) {
                        block.appendChild(mediaEl);
                    }

                    interfaceList.appendChild(block);
                });
            } catch (error) {
                console.error('인터페이스 목록을 불러오지 못했습니다.', error);
                interfaceList.innerHTML = '<p>인터페이스 소개를 불러오지 못했습니다.</p>';
            }
        }

        const questionList = document.getElementById('questionList');

        renderInterfaceList();
        renderQuestionList();

        async function renderQuestionList() {
            if (!questionList) return;
            try {
                const questions = await loadQuestionDefinitions();
                questionList.innerHTML = '';
                questions.forEach(question => {
                    const li = document.createElement('li');
                    li.innerHTML = question.text;
                    questionList.appendChild(li);
                });
            } catch (error) {
                console.error('질문 목록을 불러오지 못했습니다.', error);
                questionList.innerHTML = '<li>질문 정보를 불러오지 못했습니다.</li>';
            }
        }

        const form = document.getElementById('participantForm');
        const nameInput = document.getElementById('name');
        const ageInput = document.getElementById('age');
        const genderInput = document.getElementById('gender');
        const nextBtn = document.getElementById('nextBtn');

        // 실시간 유효성 검사
        function validateForm() {
            let isValid = true;

            // 이름 검증
            if (nameInput.value.trim() === '') {
                nameInput.classList.add('error');
                document.getElementById('nameError').style.display = 'block';
                isValid = false;
            } else {
                nameInput.classList.remove('error');
                document.getElementById('nameError').style.display = 'none';
            }

            // 나이 검증
            const age = parseInt(ageInput.value);
            if (!ageInput.value || isNaN(age) || age < 1 || age > 150) {
                ageInput.classList.add('error');
                document.getElementById('ageError').style.display = 'block';
                isValid = false;
            } else {
                ageInput.classList.remove('error');
                document.getElementById('ageError').style.display = 'none';
            }

            // 성별 검증
            const gender = genderInput.value.trim().toLowerCase();
            if (gender !== '남' && gender !== '여' && gender !== 'male' && gender !== 'female') {
                genderInput.classList.add('error');
                document.getElementById('genderError').style.display = 'block';
                isValid = false;
            } else {
                genderInput.classList.remove('error');
                document.getElementById('genderError').style.display = 'none';
            }

            return isValid;
        }

        // 입력 필드 변경 시 실시간 검증
        nameInput.addEventListener('input', validateForm);
        ageInput.addEventListener('input', validateForm);
        genderInput.addEventListener('input', validateForm);

        // 폼 제출 처리
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateForm()) {
                // 참가자 정보를 localStorage에 저장
                const participantData = {
                    name: nameInput.value.trim(),
                    age: parseInt(ageInput.value),
                    gender: genderInput.value.trim(),
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('participantData', JSON.stringify(participantData));
                
                // 테스트 단계 초기화
                localStorage.setItem('currentTestStep', '0');
                localStorage.removeItem('testResults');
                localStorage.removeItem('interfaceDataPairs');
                
                // 다음 페이지로 이동
                window.location.href = 'test.html';
            }
        });

        // 초기 버튼 상태 설정
        validateForm();
    </script>
</body>
</html>

